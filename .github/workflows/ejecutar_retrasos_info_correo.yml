name: Importar Retrasos Diarios de correo

# ¿Cuándo se ejecuta?
on:
  # Opción 1: Manualmente (aparecerá un botón para ejecutarlo cuando quieras)
  workflow_dispatch:
  
  # Opción 2: Automáticamente (Cron job)
  # Por ejemplo: A las 15:00 UTC todos los días (puedes ajustar esto)
  # Si no quieres que corra solo todavía, puedes borrar estas dos lineas de abajo 'schedule' y '- cron'.
  schedule:
    - cron: '0 15 * * *' 

jobs:
  correr-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del código
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar dependencias
        run: |
          pip install -r requirements.txt

      - name: Ejecutar script de importación
        env:
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: python importar_retrasos.py

      # --- NUEVO: NOTIFICACIÓN DE ÉXITO ---
      - name: Enviar correo de Éxito
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: ✅ Éxito:Retrasos actualizados (Esum)
          body: El script se ejecutó correctamente y los datos están en Google Sheets.
          to: tucorreo@gmail.com # <--- ¡CAMBIA ESTO POR TU CORREO DESTINO!
          from: Robot GitHub

      # --- NUEVO: NOTIFICACIÓN DE ERROR ---
      - name: Enviar correo de Error
        if: failure()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: ❌ Error:Falló la actualización (Esum)
          body: Algo salió mal. Por favor entra a GitHub Actions para ver el error.
          to: tucorreo@gmail.com # <--- ¡CAMBIA ESTO TAMBIÉN!
          from: Robot GitHub
